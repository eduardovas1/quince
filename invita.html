<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quince A√±os - Valeria Abigail</title>

  <!-- Fonts parecidas al estilo de la tarjeta -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#e9e4dc;
      --paper:#f6f2eb;
      --ink:#4a3a4a;
      --lav:#8c6a8c;
      --lav2:#a78aa7;
      --muted:#7b6a7b;
      --rope:#cfc6b7;
      --shadow:0 22px 60px rgba(0,0,0,.18);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(1200px 600px at 50% 10%, #f7f3ed, var(--bg));
      font-family:"Playfair Display", serif;
      color:var(--ink);
      padding:18px;
    }

    /* Tarjeta */
    .card{
      width:min(720px, 96vw);
      background:
        radial-gradient(900px 450px at 50% 0%, rgba(255,255,255,.65), transparent 60%),
        linear-gradient(180deg, #d9d0c5 0%, #f3eee7 52%, #f6f2eb 100%);
      border-radius:18px;
      position:relative;
      box-shadow:var(--shadow);
      overflow:hidden;
      padding:26px;
    }

    /* Marco tipo cuerda (CSS + conic gradient) */
    .ropeFrame{
      position:absolute;
      inset:0;
      pointer-events:none;
    }
    .ropeFrame::before{
      content:"";
      position:absolute;
      inset:12px;
      border-radius:14px;
      /* ‚Äúcuerda‚Äù simulada */
      background:
        repeating-linear-gradient(45deg,
          rgba(255,255,255,.35) 0 6px,
          rgba(0,0,0,.04) 6px 12px);
      mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      padding:10px;
      box-shadow:
        inset 0 0 0 10px rgba(210,200,185,.75),
        inset 0 0 0 11px rgba(255,255,255,.35);
    }
    .ropeFrame::after{
      content:"";
      position:absolute;
      inset:22px;
      border-radius:12px;
      box-shadow: inset 0 0 0 1px rgba(120,100,120,.12);
    }

    /* Top icons (opcionales) */
    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:6px 6px 0;
      opacity:.55;
      font-size:14px;
      letter-spacing:.04em;
    }
    .logoBox{
      width:64px;height:48px;
      border:1px dashed rgba(90,70,90,.3);
      border-radius:8px;
      display:grid;place-items:center;
      font-size:12px;
    }
    .dress{
      width:44px;height:44px;
      display:grid;place-items:center;
      border-radius:10px;
      border:1px solid rgba(90,70,90,.18);
      background:rgba(255,255,255,.25);
    }

    /* Header floral */
    .hero{
      margin-top:10px;
      display:grid;
      place-items:center;
      padding:4px 0 8px;
    }

    .subtitle{
      margin:8px 0 0;
      font-size:20px;
      color:rgba(70,55,70,.55);
    }

    /* Nombre */
    .inviteLine{
      text-align:center;
      margin-top:10px;
      font-size:22px;
      letter-spacing:.03em;
      color:rgba(70,55,70,.62);
    }
    .name{
      font-family:"Great Vibes", cursive;
      font-size:64px;
      line-height:1;
      margin:10px 0 10px;
      color:var(--lav);
    }

    .meta{
      text-align:center;
      margin-top:8px;
      color:rgba(70,55,70,.75);
      font-size:22px;
    }
    .meta small{
      display:block;
      margin-top:4px;
      font-size:18px;
      color:rgba(70,55,70,.62);
    }

    .divider{
      width:min(520px, 80%);
      height:1px;
      margin:18px auto;
      background: linear-gradient(90deg, transparent, rgba(120,90,120,.35), transparent);
    }

    /* Bot√≥n estilo tarjeta */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-top:12px;
      padding:14px 26px;
      border-radius:999px;
      border:1px solid rgba(120,90,120,.32);
      background: rgba(255,255,255,.35);
      color:rgba(70,55,70,.9);
      font-size:20px;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      transition: transform .15s ease, background .15s ease;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.5); }
    .btn:active{ transform: translateY(0px); }

    .count{
      text-align:center;
      margin-top:16px;
      font-size:18px;
      color:rgba(70,55,70,.62);
    }

    /* Modal */
    .backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.38);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(560px, 96vw);
      background:rgba(246,242,235,.98);
      border-radius:18px;
      box-shadow:var(--shadow);
      border:1px solid rgba(120,90,120,.18);
      padding:16px;
      position:relative;
      overflow:hidden;
    }
    .modal::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(600px 220px at 50% 0%, rgba(255,255,255,.9), transparent 55%),
        linear-gradient(180deg, rgba(217,208,197,.5), transparent 65%);
      opacity:.55;
      pointer-events:none;
    }
    .modalInner{ position:relative; }
    .modal h3{
      margin:8px 0 6px;
      text-align:center;
      color:var(--lav);
      font-weight:600;
      font-size:22px;
    }
    .modal p{
      margin:0 0 12px;
      text-align:center;
      color:rgba(70,55,70,.68);
      font-size:14px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .grid{ grid-template-columns: 1fr; }
      .name{ font-size:52px; }
    }
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(120,90,120,.18);
      background:rgba(255,255,255,.65);
      outline:none;
      font-size:15px;
    }
    .actions{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .btn2{
      flex:1;
      padding:12px 14px;
      border-radius:14px;
      border:none;
      cursor:pointer;
      font-weight:600;
      font-size:16px;
    }
    .cancel{ background:rgba(0,0,0,.06); }
    .send{
      background:linear-gradient(180deg, #b59ab5, #8c6a8c);
      color:white;
    }
    .msgOk, .msgErr{
      margin-top:10px;
      text-align:center;
      font-size:14px;
      display:none;
    }
    .msgOk{ color:#2e7d32; }
    .msgErr{ color:#b00020; }

    /* SVG wrapper */
    .wreathWrap{
      width:min(460px, 86vw);
      margin:0 auto;
    }
    svg{ width:100%; height:auto; display:block; }
  </style>
</head>

<body>
  <main class="card">
    <div class="ropeFrame"></div>

    <div class="topRow">
      <div class="logoBox">TU LOGO</div>
      <div class="subtitle">Quincea√±era</div>
      <div class="dress">üëó</div>
    </div>

    <!-- Corona floral + 15 -->
    <section class="hero">
      <div class="wreathWrap">
        <svg viewBox="0 0 520 360" role="img" aria-label="Corona floral con 15">
          <defs>
            <!-- Suavizado ‚Äúacuarela‚Äù -->
            <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="0.6" />
            </filter>

            <radialGradient id="petalGrad" cx="35%" cy="30%" r="75%">
              <stop offset="0%" stop-color="#f3ecff"/>
              <stop offset="55%" stop-color="#c1a8e3"/>
              <stop offset="100%" stop-color="#8f70bf"/>
            </radialGradient>

            <linearGradient id="leafGrad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#cdebd4"/>
              <stop offset="100%" stop-color="#62b07b"/>
            </linearGradient>

            <!-- una flor peque√±a -->
            <g id="flower" filter="url(#soft)">
              <ellipse cx="0" cy="-12" rx="7.2" ry="12" fill="url(#petalGrad)"/>
              <ellipse cx="10" cy="-4" rx="7.2" ry="12" fill="url(#petalGrad)" transform="rotate(72)"/>
              <ellipse cx="7" cy="9" rx="7.2" ry="12" fill="url(#petalGrad)" transform="rotate(144)"/>
              <ellipse cx="-7" cy="9" rx="7.2" ry="12" fill="url(#petalGrad)" transform="rotate(216)"/>
              <ellipse cx="-10" cy="-4" rx="7.2" ry="12" fill="url(#petalGrad)" transform="rotate(288)"/>
              <circle cx="0" cy="0" r="3.4" fill="#f7f0c3"/>
            </g>

            <!-- hoja -->
            <g id="leaf" filter="url(#soft)">
              <path d="M0,0 C16,-11 20,-30 6,-40 C-7,-30 -11,-11 0,0 Z" fill="url(#leafGrad)" opacity="0.95"/>
              <path d="M0,0 C2,-12 4,-24 6,-40" stroke="#3c7e55" stroke-width="1.2" opacity="0.35" fill="none"/>
            </g>

            <!-- arco gu√≠a (corona como la imagen: fuerte izquierda + base, y un toque derecha) -->
            <path id="arcLeft" d="M260 56 A140 140 0 0 0 120 210" />
            <path id="arcBottom" d="M120 210 A140 140 0 0 0 300 255" />
            <path id="arcRightSmall" d="M390 190 A140 140 0 0 0 405 210" />
          </defs>

          <!-- c√≠rculo punteado -->
          <circle cx="260" cy="180" r="140"
                  fill="none"
                  stroke="#b8a9b8"
                  stroke-width="2.2"
                  stroke-dasharray="2.4 7"
                  stroke-linecap="round"
                  opacity="0.95"/>

          <!-- ramitas base -->
          <use href="#arcLeft" fill="none" stroke="#8c6a8c" stroke-width="4.8" stroke-linecap="round" opacity="0.95"/>
          <use href="#arcBottom" fill="none" stroke="#8c6a8c" stroke-width="4.2" stroke-linecap="round" opacity="0.92"/>
          <use href="#arcRightSmall" fill="none" stroke="#8c6a8c" stroke-width="3.2" stroke-linecap="round" opacity="0.75"/>

          <!-- Flores/hojas posicionadas "a mano" para parecerse a la referencia -->
          <g id="wreath">
            <!-- izquierda superior (denso) -->
            <g transform="translate(175 95) rotate(-30) scale(1.05)"><use href="#leaf"/></g>
            <g transform="translate(155 120) rotate(-45) scale(0.95)"><use href="#flower"/></g>
            <g transform="translate(170 145) rotate(-35) scale(1.00)"><use href="#flower"/></g>
            <g transform="translate(150 165) rotate(-55) scale(0.90)"><use href="#leaf"/></g>
            <g transform="translate(165 190) rotate(-65) scale(0.92)"><use href="#flower"/></g>
            <g transform="translate(155 215) rotate(-75) scale(0.86)"><use href="#flower"/></g>
            <g transform="translate(175 240) rotate(-95) scale(0.88)"><use href="#leaf"/></g>

            <!-- base (flores en curva inferior) -->
            <g transform="translate(210 258) rotate(-105) scale(0.86)"><use href="#leaf"/></g>
            <g transform="translate(235 270) rotate(-110) scale(0.90)"><use href="#flower"/></g>
            <g transform="translate(265 276) rotate(-95) scale(0.92)"><use href="#flower"/></g>
            <g transform="translate(295 270) rotate(-75) scale(0.88)"><use href="#leaf"/></g>
            <g transform="translate(318 258) rotate(-55) scale(0.86)"><use href="#flower"/></g>

            <!-- derecha (toque peque√±o) -->
            <g transform="translate(405 198) rotate(15) scale(0.78)"><use href="#leaf"/></g>
            <g transform="translate(410 220) rotate(25) scale(0.74)"><use href="#flower"/></g>
            <g transform="translate(392 234) rotate(-10) scale(0.70)"><use href="#flower"/></g>
          </g>

          <!-- n√∫mero 15 -->
          <text x="260" y="210"
                text-anchor="middle"
                font-size="112"
                fill="#9c7f9c"
                opacity="0.9"
                style="font-family:'Playfair Display', serif; font-weight:600;">
            15
          </text>
        </svg>
      </div>

      <div class="inviteLine">EST√ÅIS CORDIALMENTE INVITADOS</div>
      <div class="inviteLine" style="margin-top:4px;">a celebrar con</div>

      <div class="name">Valeria Abigail<br/>V√°squez G√≥mez</div>

      <div class="meta">
        Mi√©rcoles 28 de febrero
        <small>12:00 P.M.</small>
      </div>

      <div class="divider"></div>

      <div class="meta" style="margin-top:0;">
        Bella Uni√≥n, al costado del Sauna Ed√©n
        <small>Padres: Marina G√≥mez e Isael V√°squez</small>
      </div>

      <button class="btn" id="openRsvp">Confirmar Asistencia</button>

      <div class="count">Asistentes confirmados: <b id="totalCount">0</b></div>
    </section>
  </main>

  <!-- Modal RSVP -->
  <div class="backdrop" id="backdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Confirmaci√≥n de asistencia">
      <div class="modalInner">
        <h3>Confirmaci√≥n de asistencia</h3>
        <p>Registra tu confirmaci√≥n y cu√°ntas personas asistir√°n en total (cont√°ndote).</p>

        <form id="rsvpForm">
          <div class="grid">
            <input id="fullName" type="text" placeholder="Nombre completo *" required />
            <input id="phone" type="tel" placeholder="Tel√©fono (opcional)" />
            <select id="willAttend" required>
              <option value="">¬øAsistir√°? *</option>
              <option value="si">S√≠</option>
              <option value="no">No</option>
            </select>
            <input id="peopleCount" type="number" min="1" max="15" placeholder="¬øCu√°ntas personas? (1‚Äì15)" />
          </div>

          <div class="actions">
            <button type="button" class="btn2 cancel" id="closeRsvp">Cancelar</button>
            <button type="submit" class="btn2 send" id="sendBtn">Enviar</button>
          </div>

          <div class="msgOk" id="okMsg">‚úÖ ¬°Gracias! Tu confirmaci√≥n fue registrada.</div>
          <div class="msgErr" id="errMsg">‚ùå Ocurri√≥ un error. Intenta nuevamente.</div>
        </form>
      </div>
    </div>
  </div>

  <!-- Firebase + Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import {
      getFirestore,
      doc,
      onSnapshot,
      collection,
      addDoc,
      serverTimestamp,
      updateDoc,
      increment
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // Tu config (ya pegada)
    const firebaseConfig = {
      apiKey: "AIzaSyAiSUeZm7VjaGKVjS58xMllXrBxifLvcJU",
      authDomain: "quince-valeria.firebaseapp.com",
      projectId: "quince-valeria",
      storageBucket: "quince-valeria.firebasestorage.app",
      messagingSenderId: "475713605323",
      appId: "1:475713605323:web:82d84b9df0ee40b43bd54e",
      measurementId: "G-RFF8RBXLQ7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // UI
    const backdrop = document.getElementById("backdrop");
    const openRsvp = document.getElementById("openRsvp");
    const closeRsvp = document.getElementById("closeRsvp");
    const form = document.getElementById("rsvpForm");
    const okMsg = document.getElementById("okMsg");
    const errMsg = document.getElementById("errMsg");
    const sendBtn = document.getElementById("sendBtn");

    const fullName = document.getElementById("fullName");
    const phone = document.getElementById("phone");
    const willAttend = document.getElementById("willAttend");
    const peopleCount = document.getElementById("peopleCount");

    openRsvp.onclick = () => { backdrop.style.display = "flex"; };
    closeRsvp.onclick = () => { backdrop.style.display = "none"; };
    backdrop.addEventListener("click", (e) => {
      if (e.target === backdrop) backdrop.style.display = "none";
    });

    // UX: si NO asiste, deshabilita cantidad
    willAttend.addEventListener("change", () => {
      if (willAttend.value === "no") {
        peopleCount.value = "";
        peopleCount.disabled = true;
      } else {
        peopleCount.disabled = false;
      }
    });

    // Contador en vivo
    const totalCountEl = document.getElementById("totalCount");
    const statsRef = doc(db, "stats", "public");

    onSnapshot(statsRef, (snap) => {
      const total = snap.exists() ? (snap.data().totalAsistentes ?? 0) : 0;
      totalCountEl.textContent = String(total);
    });

    // Enviar RSVP + incrementar stats
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      okMsg.style.display = "none";
      errMsg.style.display = "none";

      const nombre = fullName.value.trim();
      const telefono = phone.value.trim() || null;
      const asistira = willAttend.value;

      let cantidad = 0;
      if (asistira === "si") {
        const n = Number(peopleCount.value);
        if (!Number.isFinite(n) || n < 1) {
          errMsg.textContent = "‚ùå Indica cu√°ntas personas asistir√°n (m√≠nimo 1).";
          errMsg.style.display = "block";
          return;
        }
        cantidad = Math.min(Math.floor(n), 15);
      }

      try {
        sendBtn.disabled = true;

        await addDoc(collection(db, "rsvps"), {
          nombre,
          telefono,
          asistira,
          cantidad,
          evento: "Quince A√±os Valeria Abigail",
          creadoEn: serverTimestamp()
        });

        if (asistira === "si" && cantidad > 0) {
          await updateDoc(statsRef, { totalAsistentes: increment(cantidad) });
        }

        okMsg.style.display = "block";
        form.reset();
        peopleCount.disabled = false;

        setTimeout(() => { backdrop.style.display = "none"; }, 1000);
      } catch (err) {
        console.error(err);
        errMsg.textContent = "‚ùå Ocurri√≥ un error. Revisa tus Rules y que exista stats/public.";
        errMsg.style.display = "block";
      } finally {
        sendBtn.disabled = false;
      }
    });
  </script>
</body>
</html>